{% extends "base.html" %}

{% block content %}
<div class="battlepass-grid">
    {% for image in battlepass_images %}
    <div class="battlepass-item">
        {% if user.has_viewed_image(image.id) %}
            <img src="{{ url_for('serve_image', filename=image.season + '/' + image.filename) }}" 
                 alt="Battle Pass Image"
                 class="battlepass-image">
        {% else %}
            <div class="locked-image">
                <span>ðŸ”’</span>
                <button class="unlock-button" 
                        onclick="unlockImage({{ image.id }})"
                        {% if user.tokens < 1 %}disabled{% endif %}>
                    Unlock (1 Token)
                </button>
            </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

<script>
function unlockImage(imageId) {
    fetch(`/unlock_image/${imageId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'Failed to unlock image');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to unlock image');
        });
}
</script>

<style>
.locked-image {
    width: 200px;
    height: 200px;
    background-color: #f5f5f5;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
}

.locked-image span {
    font-size: 48px;
    margin-bottom: 16px;
}

.unlock-button {
    padding: 8px 16px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.unlock-button:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
}

.unlock-button:hover:not(:disabled) {
    background-color: #45a049;
}
</style>
{% endblock %}