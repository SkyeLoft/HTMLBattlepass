{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Battle Pass - {{ season }}</h1>
    <p>Your Level: {{ user.battle_pass_level }}</p>
    <p>Your Tokens: {{ user.tokens }}</p>
    
    <div class="battlepass-grid">
        {% for image in battlepass_images %}
            <div class="battlepass-item">
                {% if user.has_viewed_image(image.id) %}
                    <!-- Show the unlocked image -->
                    <img src="/images/{{ image.season }}/{{ image.filename }}" 
                         alt="Battle Pass Image"
                         class="battlepass-image">
                {% else %}
                    <!-- Show unlock button -->
                    <button class="unlock-button" 
                            data-image-id="{{ image.id }}"
                            onclick="unlockImage({{ image.id }})">
                        Unlock Image (10 tokens)
                    </button>
                {% endif %}
                <p>Level Required: {{ image.required_level }}</p>
            </div>
        {% endfor %}
    </div>
</div>

<script>
function unlockImage(imageId) {
    fetch(`/unlock_image/${imageId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Reload the page to show the newly unlocked image
                location.reload();
            } else {
                alert('Not enough tokens to unlock this image!');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while trying to unlock the image.');
        });
}
</script>

<style>
.battlepass-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    padding: 20px;
}

.battlepass-item {
    text-align: center;
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 8px;
}

.battlepass-image {
    max-width: 100%;
    height: auto;
}

.unlock-button {
    width: 100%;
    padding: 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin: 10px 0;
}

.unlock-button:hover {
    background-color: #45a049;
}
</style>
{% endblock %}