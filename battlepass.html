<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Pass</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css">
    <style>
        .battlepass-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Adjusted min-width */
            gap: 0.5rem; /* Adjusted gap */
            padding: 1rem;
        }
        .battlepass-item {
            position: relative;
            text-align: center;
        }
        .battlepass-item img {
            width: 120%; /* Adjusted width to fit card */
            height: auto;
            border-radius: 8px; /* Match card border radius */
        }
        .locked {
            filter: blur(10px);
        }
        .unlock-button {
            position: absolute;
            bottom: 5px; /* Adjusted position */
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem; /* Adjusted font size */
        }
        .card {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin: 1rem;
            overflow: hidden; /* Ensure content fits within card */
        }
    </style>
    <script src="scan_images.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
</head>
<body>
  <nav class="navbar">
      <div>
        <a href="/index.html">Home</a>
        <a href="/collection.html">Collection</a>
        <a href="/battlepass.html">BattlePass</a>
        <a href="/about.html">About</a>
      </div>
      <div>
      Season 2
      </div>
    </nav>
    <h1> Season 2 Battle Pass</h1>
    <div id="tokens">Tokens: <span id="tokenCount">0</span></div>
    <div class="battlepass-container" id="battlepassContent"></div>

    <script>
        let battlepassImages = {};
        let tokens = parseInt(localStorage.getItem('tokens')) || 0;
        let viewedImages = JSON.parse(localStorage.getItem('viewedImages')) || [];

        // Load images by scanning
        getOrScanImages()
            .then(data => {
                // Filter for battlepass folders only
                battlepassImages = Object.fromEntries(
                    Object.entries(data).filter(([key]) => key.endsWith('_battlepass'))
                );
                // Initialize after loading image data
                displayBattlepass();
            })
            .catch(error => console.error('Error loading images:', error));

        function updateTokenDisplay() {
            document.getElementById('tokenCount').textContent = tokens;
        }

        function unlockImage(imagePath) {
            if (tokens >= 1) {
                tokens--;
                viewedImages.push(imagePath);
                localStorage.setItem('tokens', tokens);
                localStorage.setItem('viewedImages', JSON.stringify(viewedImages));
                updateTokenDisplay();
                displayBattlepass();
            } else {
                alert('Not enough tokens!');
            }
        }

        function displayBattlepass() {
            const container = document.getElementById('battlepassContent');
            container.innerHTML = '';

            Object.entries(battlepassImages).forEach(([folder, images]) => {
                images.forEach(image => {
                    const imagePath = `images/${folder}/${image}`;
                    const div = document.createElement('div');
                    div.className = 'battlepass-item card';

                    const img = document.createElement('img');
                    img.src = imagePath;
                    img.alt = 'Battlepass Image';
                    
                    if (!viewedImages.includes(imagePath)) {
                        img.className = 'locked';
                        const button = document.createElement('button');
                        button.textContent = 'Unlock (1 token)';
                        button.className = 'unlock-button';
                        button.onclick = () => unlockImage(imagePath);
                        div.appendChild(button);
                        div.appendChild(img);
                    } else {
                        const a = document.createElement('a');
                        a.href = imagePath;
                        a.setAttribute('data-lightbox', 'battlepass-gallery');
                        a.appendChild(img);
                        div.appendChild(a);
                    }

                    container.appendChild(div);
                });
            });
        }

        // Initialize token display
        updateTokenDisplay();
    </script>
</body>
</html>